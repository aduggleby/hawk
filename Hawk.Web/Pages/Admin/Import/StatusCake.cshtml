@page
@* <summary>Admin-only import page for StatusCake exports.</summary> *@
@model Hawk.Web.Pages.Admin.Import.StatusCakeModel
@{
    ViewData["Title"] = "Import: StatusCake";
}

<div class="mb-6">
    <h1 class="text-2xl font-semibold tracking-tight">Import: StatusCake</h1>
    <p class="text-sm text-zinc-600">Upload exported JSON from StatusCake to create monitors and/or import alert history.</p>
</div>

<div class="hawk-card p-4 mb-6">
    <h2 class="font-semibold mb-2">Accepted Formats</h2>
    <div class="text-sm text-zinc-700 space-y-2">
        <p><span class="font-mono">Tests</span>: raw JSON from StatusCake <span class="font-mono">GET /v1/uptime</span> (object with a <span class="font-mono">data</span> array) or a plain array of tests.</p>
        <p><span class="font-mono">Alerts</span>: a JSON array of groups: <span class="font-mono">[{ "test_id": "123", "data": [ ... ] }, ...]</span></p>
        <p class="text-xs text-zinc-500">Note: tests imported with <span class="font-mono">DoNotFind</span> are created as disabled (Hawk v1 does not support inverted body matching).</p>
    </div>
</div>

<form method="post" enctype="multipart/form-data" class="hawk-card p-4 space-y-4">
    <div class="grid md:grid-cols-3 gap-4">
        <div class="md:col-span-1">
            <label class="hawk-label" for="ImportType">Import type</label>
            <select class="hawk-input" id="ImportType" asp-for="ImportType">
                <option value="tests">Tests (create monitors)</option>
                <option value="alerts">Alerts (import run history)</option>
            </select>
        </div>
        <div class="md:col-span-2">
            <label class="hawk-label" for="Upload">JSON file</label>
            <input class="hawk-input" id="Upload" type="file" asp-for="Upload" accept=".json,application/json" />
            <span class="text-xs text-zinc-500">Upload a file exported from StatusCake (see README for export commands).</span>
        </div>
    </div>

    <div>
        <button class="hawk-btn hawk-btn-primary" type="submit">Import</button>
        <a class="hawk-btn hawk-btn-ghost ml-2" asp-page="/Admin/Users/Index">Back to Users</a>
    </div>

    @if (Model.Result is not null)
    {
        <div class="mt-6 border-t border-zinc-100 pt-4">
            <h2 class="font-semibold mb-2">Result</h2>
            <div class="text-sm">
                <div>
                    <span class="font-mono">Monitors created:</span>
                    <span data-testid="import-monitors-created">@Model.Result.MonitorsCreated</span>
                </div>
                <div>
                    <span class="font-mono">Runs created:</span>
                    <span data-testid="import-runs-created">@Model.Result.RunsCreated</span>
                </div>
            </div>

            @if (Model.Result.Warnings.Count != 0)
            {
                <div class="mt-3">
                    <div class="text-xs font-semibold text-zinc-600 mb-1">Warnings</div>
                    <ul class="text-xs text-zinc-700 list-disc pl-5 space-y-1">
                        @foreach (var w in Model.Result.Warnings)
                        {
                            <li>@w</li>
                        }
                    </ul>
                </div>
            }
        </div>
    }
</form>
